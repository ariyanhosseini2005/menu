<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ù†ÙˆÛŒ Ø³Ù†Ø¯ØªÙ† â€¢ Ù†Ø³Ø®Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ (Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±)</title>
  <link rel="icon" href="logo.jpg">
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0F0F12; --card:#15161A; --muted:#9aa4b2; --text:#EDEFF3; --soft:#1B1D23; --royal:#8E3DBB; --gold:#FFC20E; --accent:#2BD4BD; --danger:#FF5A7C; --ring:0 0 0 2px rgba(142,61,187,.35) }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;height:100%}
    body{font-family:"Vazirmatn","Segoe UI",Arial,sans-serif;background:radial-gradient(1200px 800px at 80% -10%, rgba(142,61,187,.18), transparent 60%),radial-gradient(900px 700px at -10% 110%, rgba(43,212,189,.12), transparent 55%), var(--bg);color:var(--text);line-height:1.7}
    a{color:var(--gold);text-decoration:none}
    button{font-family:inherit}
    .container{max-width:520px;margin:0 auto;padding:16px}
    header.app{position:sticky;top:0;z-index:30;background:linear-gradient(180deg, rgba(15,15,18,.85), rgba(15,15,18,.55) 70%, transparent);backdrop-filter: blur(10px);border-bottom:1px solid rgba(255,255,255,.06)}
    .head-wrap{display:flex;gap:12px;align-items:center;padding:12px 16px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:52px;height:52px;object-fit:cover;border-radius:14px;border:1px solid rgba(255,255,255,.08);box-shadow:0 6px 16px rgba(0,0,0,.35)}
    .brand h1{margin:0;font-size:20px;font-weight:900;letter-spacing:.2px}
    .sub{font-size:12px;color:var(--muted)}
    .toolbar{display:grid;grid-template-columns:1fr auto;gap:10px;padding:10px 16px 16px}
    .search{position:relative}
    .search input{width:100%;padding:14px 44px 14px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,#121318,#0f1014);color:var(--text);outline:none;box-shadow: inset 0 0 0 1px rgba(255,255,255,.03)}
    .search input:focus{box-shadow: var(--ring)}
    .search .ico{position:absolute;right:12px;top:50%;transform:translateY(-50%);opacity:.7}
    .call-row{display:flex;align-items:center;gap:12px;justify-content:flex-start;flex-wrap:wrap}
    .tel{direction:ltr; unicode-bidi:bidi-override; font-variant-numeric:tabular-nums; letter-spacing:.4px;}
    .tel a{color:inherit}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;background:linear-gradient(180deg,#171821,#12131a);border:1px solid rgba(255,255,255,.08);font-size:13px;color:#d7dbe3}
    .chips{position:sticky;top:92px;z-index:25;background:linear-gradient(180deg, rgba(15,15,18,.85), rgba(15,15,18,.4));backdrop-filter: blur(8px);padding:10px 16px;border-bottom:1px dashed rgba(255,255,255,.06)}
    .chip-row{display:flex;gap:8px;overflow:auto;padding-bottom:4px}
    .chip{white-space:nowrap;padding:8px 12px;border-radius:10px;background:#14161b;border:1px solid rgba(255,255,255,.08);font-size:13px;color:#cfd5dd;cursor:pointer;transition:transform .2s ease}
    .chip.active{background:linear-gradient(180deg, rgba(142,61,187,.2), rgba(142,61,187,.05));border-color:rgba(142,61,187,.45);color:#fff}
    .chip:hover{transform:translateY(-2px)}
    main{padding:10px 16px 80px}
    section.cat{margin-bottom:22px}
    h2.cat-title{margin:0 0 10px;font-size:18px;font-weight:900;color:var(--gold);display:flex;align-items:center;gap:8px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:640px){.grid{grid-template-columns:1fr}}
    @media(min-width:960px){.grid{grid-template-columns:1fr}}
    .card{position:relative;background:linear-gradient(180deg,#14161b,#101218);border:1px solid rgba(255,255,255,.06);border-radius:16px;overflow:hidden;display:grid;grid-template-columns:120px 1fr}
    @media(max-width:560px){.card{grid-template-columns:1fr;box-shadow:0 10px 30px rgba(0,0,0,.25)}}
    .pic{background:radial-gradient(220px 140px at 50% 20%, rgba(142,61,187,.25), transparent 60%), #0d0f14}
    .pic img{width:100%;height:100%;object-fit:cover;display:block}
    .info{padding:12px}
    .title{margin:0 0 6px;font-size:15px;font-weight:800}
    .price{font-size:13px;font-weight:900;color:var(--gold)}
    .actions{margin-top:10px;display:flex;gap:8px;align-items:center}
    .btn{padding:9px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.09);background:linear-gradient(180deg,#1b1d24,#151720);color:#e9edf3;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#3e2550,#2a1836);border-color:rgba(142,61,187,.6)}
    .btn:active{transform:translateY(1px)}
    .qty{display:flex;align-items:center;gap:6px;margin-inline-start:auto}
    .qty button{width:28px;height:28px;border-radius:8px;border:1px solid rgba(255,255,255,.1);background:#12141a;color:#fff}
    .badge{position:absolute;top:8px;left:8px;padding:4px 8px;border-radius:999px;background:rgba(43,212,189,.15);border:1px solid rgba(43,212,189,.45);font-size:11px;color:#9bf1e2}
    .fab{position:fixed;bottom:18px;right:18px;z-index:40;display:flex;align-items:center;gap:10px;padding:12px 14px;border-radius:999px;background:linear-gradient(180deg,#3e2550,#2a1836);color:#fff;border:1px solid rgba(142,61,187,.55);box-shadow:0 10px 30px rgba(0,0,0,.4);cursor:pointer}
    .fab .count{background:#111;border:1px solid rgba(255,255,255,.18);padding:2px 8px;border-radius:999px;font-size:12px}
    .drawer{position:fixed;inset:0;display:none}
    .drawer.active{display:block}
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,.55)}
    .panel{position:absolute;top:0;right:0;height:100%;width:min(420px,94%);background:linear-gradient(180deg,#14161b,#0f1117);border-left:1px solid rgba(255,255,255,.06);box-shadow:-8px 0 30px rgba(0,0,0,.45);display:flex;flex-direction:column}
    .panel header{display:flex;align-items:center;justify-content:space-between;padding:14px;border-bottom:1px solid rgba(255,255,255,.06)}
    .cart-list{padding:10px 12px;flex:1;overflow:auto}
    .cart-item{display:grid;grid-template-columns:56px 1fr auto;gap:10px;align-items:center;padding:10px;border:1px solid rgba(255,255,255,.06);border-radius:14px;background:linear-gradient(180deg,#161820,#12141a);margin-bottom:10px}
    .cart-item img{width:56px;height:56px;object-fit:cover;border-radius:10px}
    .cart-title{font-weight:800}
    .cart-meta{font-size:12px;color:var(--muted)}
    .cart-qty{display:flex;align-items:center;gap:6px}
    .cart-qty button{width:28px;height:28px;border-radius:8px;border:1px solid rgba(255,255,255,.1);background:#12141a;color:#fff}
    .remove{border:1px solid rgba(255,255,255,.1);background:#181a22;border-radius:8px;padding:6px 10px;color:#f7b3c0}
    .cart-foot{border-top:1px solid rgba(255,255,255,.08);padding:12px 14px;background:linear-gradient(180deg,#12141a,#0e1015)}
    .sum-row{display:flex;justify-content:space-between;font-weight:800}
    .checkout{margin-top:10px;display:flex;gap:8px}
    .btn.full{flex:1;text-align:center}
    .muted{font-size:12px;color:var(--muted)}
    footer{border-top:1px solid rgba(255,255,255,.06);color:#bdc6d4;font-size:12px;text-align:center;padding:14px}
    #qrModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:50}
    #qrCard{width:min(420px,96%);background:#1a1d25;border:1px solid #2e3340;border-radius:16px;padding:14px;color:#fff}
    #qrBox{display:flex;align-items:center;justify-content:center;background:#fff;border-radius:12px;padding:10px}
  </style>
</head>
<body>
  <header class="app">
    <div class="head-wrap container">
      <div class="brand">
        <img src="logo.jpg" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø³Ù†Ø¯ØªÙ†" />
        <div>
          <h1>Sandton â€¢ Ù…Ù†ÙˆÛŒ Ø³Ù†Ø¯ØªÙ†</h1>
          <div class="sub">sandton.garden</div>
        </div>
      </div>
    </div>
    <div class="toolbar container">
      <label class="search">
        <input id="search" type="text" placeholder=" Ø¬Ø³ØªØ¬Ùˆ: Ù†Ø§Ù… ØºØ°Ø§â€¦" />
        <span class="ico">ğŸ”</span>
      </label>
      <div class="call-row">
        <span class="pill">ğŸ“ <a href="tel:+989378938200"><span class="tel">0937 893 8200</span></a></span>
        <span class="pill">ğŸ“· <a href="https://instagram.com/sandton.garden" target="_blank" rel="noopener">sandton.garden</a></span>
        <button id="qrFab" class="pill" style="cursor:pointer">QR Ú©Ø¯</button>
      </div>
    </div>
    <div class="chips">
      <div id="chipRow" class="chip-row"></div>
    </div>
  </header>

  <main id="menu" class="container"></main>

  <footer>
    Ø³Ø§Ø¹Ø§Øª Ú©Ø§Ø±ÛŒ: ÛŒÚ©Ø´Ù†Ø¨Ù‡ ØªØ§ Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡ Û±Û¸ ØªØ§ Û²Û´ â€¢ Ø¬Ù…Ø¹Ù‡ Û±Û² ØªØ§ Û²Û´
  </footer>

  <button id="cartFab" class="fab" aria-label="Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯">ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ <span class="count" id="cartCount">0</span></button>

  <div id="cartDrawer" class="drawer" aria-hidden="true">
    <div class="overlay" id="cartOverlay"></div>
    <aside class="panel" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
      <header>
        <strong id="cartTitle">ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</strong>
        <button id="cartClose" class="btn">âœ• Ø¨Ø³ØªÙ†</button>
      </header>
      <div id="cartList" class="cart-list"></div>
      <div class="cart-foot">
        <div class="sum-row"><span>Ù…Ø¬Ù…ÙˆØ¹</span><span id="sum">Û°</span></div>
        <div class="muted" style="margin-top:6px" id="priceNote">Ù†Ù…Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª Ø·Ø¨Ù‚ ØªÙ†Ø¸ÛŒÙ… ÙØ¹Ù„ÛŒ</div>
        <div class="checkout">
          <button id="btnCopy" class="btn">Ú©Ù¾ÛŒ Ø³ÙØ§Ø±Ø´</button>
          <button id="btnCheckout" class="btn primary">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button>
          <a id="btnWA" href="#" target="_blank" class="btn full">Ø§Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³â€ŒØ§Ù¾</a>
        </div>
        <div class="muted" style="margin-top:8px">ØªÙ†Ø¸ÛŒÙ… Ù‚ÛŒÙ…Øª: <code id="curMode"></code></div>
      </div>
    </aside>
  </div>

  <div id="coModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:60">
    <div style="width:min(520px,96%);background:#171a22;border:1px solid #2e3340;border-radius:16px;padding:14px;color:#fff">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><strong>ÙØ±Ù… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</strong><button id="coClose" class="btn">âœ•</button></div>
      <form id="coForm" style="display:grid;gap:10px">
        <div style="display:grid;gap:6px">
          <label>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
          <input id="coName" required placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ" style="padding:12px;border-radius:12px;border:1px solid #333;background:#10131a;color:#fff">
        </div>
        <div style="display:grid;gap:6px">
          <label>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
          <input id="coPhone" required placeholder="09xxxxxxxxx" style="padding:12px;border-radius:12px;border:1px solid #333;background:#10131a;color:#fff" pattern="^0?9\d{9}$" title="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§ÛŒØ±Ø§Ù†ÛŒ">
        </div>
        <div style="display:grid;gap:6px">
          <label>Ù†ÙˆØ¹ ØªØ­ÙˆÛŒÙ„</label>
          <select id="coType" style="padding:12px;border-radius:12px;border:1px solid #333;background:#10131a;color:#fff">
            <option value="dinein">ØµØ±Ù Ø¯Ø± Ù…Ø­Ù„</option>
            <option value="takeaway">Ø¨ÛŒØ±ÙˆÙ†â€ŒØ¨Ø±</option>
            <option value="delivery">Ø§Ø±Ø³Ø§Ù„ (Ù¾ÛŒÚ©)</option>
          </select>
        </div>
        <div id="coTableWrap" style="display:grid;gap:6px">
          <label>Ø´Ù…Ø§Ø±Ù‡ Ù…ÛŒØ² (Ø¨Ø±Ø§ÛŒ ØµØ±Ù Ø¯Ø± Ù…Ø­Ù„)</label>
          <input id="coTable" placeholder="Ù…Ø«Ø§Ù„: Û±Û²" style="padding:12px;border-radius:12px;border:1px solid #333;background:#10131a;color:#fff">
        </div>
        <div id="coAddrWrap" style="display:none;gap:6px">
          <label>Ø¢Ø¯Ø±Ø³ (Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„)</label>
          <textarea id="coAddr" rows="3" placeholder="Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚..." style="padding:12px;border-radius:12px;border:1px solid #333;background:#10131a;color:#fff"></textarea>
        </div>
        <div style="display:grid;gap:6px">
          <label>ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
          <textarea id="coNote" rows="2" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø¯ÙˆÙ† Ø³ÛŒØ±ØŒ Ù†Ø§Ù† Ø§Ø¶Ø§ÙÙ‡ØŒ ..." style="padding:12px;border-radius:12px;border:1px solid #333;background:#10131a;color:#fff"></textarea>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end">
          <button type="button" id="coSendWA" class="btn">Ø§Ø±Ø³Ø§Ù„ Ø¯Ø± ÙˆØ§ØªØ³â€ŒØ§Ù¾</button>
          <button type="button" id="btnPay" class="btn">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ù†Ù„Ø§ÛŒÙ† (Ø¯Ù…Ùˆ)</button>
          <button type="submit" class="btn primary">Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ</button>
        </div>
      </form>
    </div>
  </div>

  <div id="qrModal">
    <div id="qrCard">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
        <strong>Ú©Ø¯ QR Ø§ÛŒÙ† ØµÙØ­Ù‡</strong>
        <button id="qrClose" class="btn">âœ•</button>
      </div>
      <div id="qrBox"><div id="qrcode"></div></div>
      <p class="muted" style="margin-top:8px">ğŸ˜ Ø§Ø³Ú©Ù† Ú©Ù† Ùˆ Ù…Ù†Ùˆ Ø±Ùˆ Ø±Ø§Ø­Øª ØªÙˆÛŒ Ú¯ÙˆØ´ÛŒØª Ø¨Ø¨ÛŒÙ†!</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <script>
    // ======== CONFIG (Ù‚ÛŒÙ…Øª) ========
    // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø¨Ø± Ø­Ø³Ø¨ Â«Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†Â» Ø§Ø³ØªØŒ Ù…Ø«Ù„Ø§Ù‹ 657 ÛŒØ¹Ù†ÛŒ 657000 ØªÙˆÙ…Ø§Ù†.
    // PRICE_MODE:
    //   'toman' => Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ ØªÙˆÙ…Ø§Ù† Ú©Ø§Ù…Ù„ (657000 ØªÙˆÙ…Ø§Ù†)
    //   'hezar' => Ø­Ø°Ù Ø³Ù‡ ØµÙØ± Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ Â«Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†Â» (657 Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†)
    const PRICE_MODE = 'mini'; // â† Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙˆÙ…Ø§Ù† Ú©Ø§Ù…Ù„ Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ 'toman'

    // ===== Data =====
    const MENU_DATA = [
      { category: "BARBECUE / Ø¨Ø§Ø±Ø¨ÛŒÚ©ÛŒÙˆ", items: [
        { title: "Ø§Ø³ØªÛŒÚ© Ú¯ÙˆØ´Øª", price: "657" },
        { title: "Ø§Ø³ØªÛŒÚ© Ù…Ø±Øº", price: "548" },
        { title: "Ø¬ÙˆØ¬Ù‡ Ø²Ø¹ÙØ±Ø§Ù†ÛŒ", price: "410" },
        { title: "Ø¬ÙˆØ¬Ù‡ ØªÙ†Ø¯ÙˆØ±ÛŒ", price: "316" },
        { title: "Ø¬ÙˆØ¬Ù‡ ØªØ±Ú©ÛŒ", price: "405" },
        { title: "Ø´ÛŒØ´Ù„ÛŒÚ©", price: "880" },
        { title: "Ú†Ù„Ùˆ", price: "206" }
      ]},
      { category: "PIZZA / Ù¾ÛŒØªØ²Ø§", items: [
        { title: "Ù¾ÛŒØªØ²Ø§ Ø§Ø³Ù¾ÛŒØ´ÛŒØ§Ù„ Ø³Ù†Ø¯ØªÙ†", price: "636" },
        { title: "Ù¾ÛŒØªØ²Ø§ Ø³ÛŒØ± Ùˆ Ø§Ø³ØªÛŒÚ©", price: "647" },
        { title: "Ù¾ÛŒØªØ²Ø§ Ù¾Ù¾Ø±ÙˆÙ†ÛŒ", price: "437" },
        { title: "Ù¾ÛŒØªØ²Ø§ Ù…Ø±Øº Ùˆ Ø¨ÙˆÙ‚Ù„Ù…ÙˆÙ†", price: "517" },
        { title: "Ù¾ÛŒØªØ²Ø§ Ø±Ø³Øª Ø¨ÛŒÙ", price: "605" }
      ]},
      { category: "BURGER / Ø¨Ø±Ú¯Ø±", items: [
        { title: "Ø¨Ø±Ú¯Ø± Ù…Ø®ØµÙˆØµ", price: "536" },
        { title: "Ù‚Ø§Ø±Ú† Ø¨Ø±Ú¯Ø±", price: "547" },
        { title: "Ø¨ÛŒÚ¯ Ø¨Ø±Ú¯Ø±", price: "572" },
        { title: "Ú†ÛŒÚ©Ù† Ø¨Ø±Ú¯Ø±", price: "410" },
        { title: "Ù‡Ø§Øª Ø¯Ø§Ú¯ Ø§Ù…Ø±ÛŒÚ©Ø§ÛŒÛŒ", price: "206" },
      ]},
      { category: "PASTA / Ù¾Ø§Ø³ØªØ§", items: [
        { title: "Ù¾Ø§Ø³ØªØ§ Ø¢Ù„ÙØ±Ø¯Ùˆ", price: "415" },
        { title: "Ú†ÛŒÚ©Ù† Ø¢Ù„ÙØ±Ø¯Ùˆ", price: "451" },
        { title: "Ø¨ÛŒÙ Ø§Ø³ØªØ±Ø§Ú¯Ø§Ù†Ù", price: "503" }
      ]},
      { category: "SALAD / Ø³Ø§Ù„Ø§Ø¯", items: [
        { title: "Ø³Ø§Ù„Ø§Ø¯ Ø³Ø²Ø§Ø±", price: "394" },
        { title: "Ø³Ø§Ù„Ø§Ø¯ ÛŒÙˆÙ†Ø§Ù†ÛŒ", price: "440" },
        { title: "Ø³Ø§Ù„Ø§Ø¯ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª", price: "330" }
      ]},
      { category: "FRIES / Ø³ÛŒØ¨â€ŒØ²Ù…ÛŒÙ†ÛŒ", items: [
        { title: "Ø³Ù†Ø¯ØªÙ† ÙØ±Ø§ÛŒØ²", price: "341" },
        { title: "Ø³ÛŒØ¨â€ŒØ²Ù…ÛŒÙ†ÛŒ Ù¾Ù†ÛŒØ±ÛŒ", price: "253" },
        { title: "Ø³ÛŒØ¨â€ŒØ²Ù…ÛŒÙ†ÛŒ Ø³Ø§Ø¯Ù‡", price: "153" }
      ]},
      { category: "SHAKE / Ø´ÛŒÚ© Ùˆ Ú©Ø±Ø§Ø´", items: [
        { title: "Ø§Ø³Ù¾ÛŒØ´Ù„ Ú©Ø±Ø§Ø´ Ø§Ø³Ù†ÛŒÚ©Ø±Ø²", price: "242" },
        { title: "Ø§Ø³Ù¾ÛŒØ´Ù„ Ú©Ø±Ø§Ø´ Ú©ÛŒØªâ€ŒÚ©Øª", price: "231" },
        { title: "Ø§Ø³Ù¾ÛŒØ´Ù„ Ú©Ø±Ø§Ø´ Ø§ÙˆØ±Ø¦Ùˆ", price: "220" },
        { title: "Ø´ÛŒÚ© Ø´Ú©Ù„Ø§Øª", price: "198" },
        { title: "Ø´ÛŒÚ© Ù…Ø¹Ø¬ÙˆÙ†", price: "297" }
      ]},
      { category: "DRINK / Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ", items: [
        { title: "Ø¢Ø¨ Ù¾Ø±ØªÙ‚Ø§Ù„", price: "280" },
        { title: "Ø¢Ø¨ Ù‡Ù†Ø¯ÙˆØ§Ù†Ù‡", price: "206" },
        { title: "Ø¢Ø¨ Ø·Ø§Ù„Ø¨ÛŒ", price: "217" },
        { title: "Ù…Ø§Ø±Ú¯Ø§Ø±ÛŒØªØ§", price: "209" },
        { title: "Ú©ÙˆÚ©ØªÙ„ Ù„Ø§ÛŒÙ‡", price: "" },
        { title: "Ù„ÛŒÙ…ÙˆÙ†Ø§Ø¯ Ø·Ø¨ÛŒØ¹ÛŒ", price: "209" },
        { title: "Ù…ÙˆÙ‡ÛŒØªÙˆ", price: "209" },
        { title: "Ø´ÛŒØ± Ù…ÙˆØ²", price: "" },
        { title: "Ø´ÛŒØ± Ù…ÙˆØ² Ù¾Ø³ØªÙ‡", price: "" },
        { title: "Ú©ÙˆÚ©Ø§Ú©ÙˆÙ„Ø§", price: "45" },
        { title: "Ù…ÛŒØ±Ø§Ù†Ø¯Ø§", price: "45" },
        { title: "ÙØ§Ù†ØªØ§", price: "45" },
        { title: "Ú©ÛŒÚ©Ø³ Ù…Ú©Ø³", price: "70" },
        { title: "Ù…Ø§Ù„Ø´Ø¹ÛŒØ±", price: "65" },
        { title: "Ù…Ø§Ù„Ø´Ø¹ÛŒØ± Ù„ÛŒÙ…Ùˆ", price: "65" },
        { title: "Ø¢Ø¨ Ù…Ø¹Ø¯Ù†ÛŒ Ú©ÙˆÚ†ÛŒÚ©", price: "10" },
        { title: "Ù‡Ø§ÛŒÙ¾", price: "65" }
      ]},
      { category: "COFFEE & TEA / Ù‚Ù‡ÙˆÙ‡ Ùˆ Ú†Ø§ÛŒ", items: [
        { title: "Ø§Ø³Ù¾Ø±Ø³Ùˆ ØªÚ©", price: "55" },
        { title: "Ø§Ø³Ù¾Ø±Ø³Ùˆ Ø¯ÙˆØ¨Ù„", price: "77" },
        { title: "Ø¢Ù…Ø±ÛŒÚ©Ø§Ù†Ùˆ", price: "121" },
        { title: "Ù…ÙˆÚ©Ø§ Ù„Ø§ØªÙ‡", price: "121" },
        { title: "Ú©Ø§ÙÙ‡ Ù„Ø§ØªÙ‡", price: "121" },
        { title: "Ú†Ø§ÛŒ Ø³Ø¨Ø²", price: "88" },
        { title: "Ú†Ø§ÛŒ", price: "60" },
      ]},
      { category: "HOOKAH / Ù‚ÛŒÙ„ÙˆÙ†", items: [
        { title: "Ø¨Ù„ÙˆØ¨Ø±ÛŒ Ù†Ø¹Ù†Ø§ ", price: "370" },
        { title: "Ø§Ù†Ø¨Ù‡", price: "370" },
        { title: "Ù„ÛŒÙ…Ùˆ Ù†Ø¹Ù†Ø§", price: "370" },
        { title: "Ù¾Ø±ØªÙ‚Ø§Ù„ Ø®Ø§Ù…Ù‡", price: "370" },
        { title: "Ø¨Ù„ÙˆØ¨Ø±ÛŒ Ø²ÛŒØªÙˆÙ†", price: "370" },
        { title: "Ù„Ø§Ùˆ", price: "370" },
        { title: "Ù…Ø³Ú©Ùˆ", price: "370" },
        { title: "Ù†Ø¹Ù†Ø§", price: "370" },
      ]}
    ];

    const IMG_MAP = {
      'Ø§Ø³ØªÛŒÚ© Ú¯ÙˆØ´Øª': 'https://source.unsplash.com/800x600/?steak',
      'Ø§Ø³ØªÛŒÚ© Ù…Ø±Øº': 'https://source.unsplash.com/800x600/?chicken-steak',
      'Ø¬ÙˆØ¬Ù‡ Ø²Ø¹ÙØ±Ø§Ù†ÛŒ': 'https://source.unsplash.com/800x600/?iranian-kebab',
      'Ø¬ÙˆØ¬Ù‡ ØªÙ†Ø¯ÙˆØ±ÛŒ': 'https://source.unsplash.com/800x600/?tandoori-chicken',
      'Ø¬ÙˆØ¬Ù‡ ØªØ±Ú©ÛŒ': 'https://source.unsplash.com/800x600/?chicken-shish',
      'Ø´ÛŒØ´Ù„ÛŒÚ©': 'https://source.unsplash.com/800x600/?shishlik',
      'Ú†Ù„Ùˆ': 'https://source.unsplash.com/800x600/?rice',
      'Ù¾ÛŒØªØ²Ø§ Ø§Ø³Ù¾ÛŒØ´ÛŒØ§Ù„ Ø³Ù†Ø¯ØªÙ†': 'https://source.unsplash.com/800x600/?gourmet-pizza',
      'Ù¾ÛŒØªØ²Ø§ Ø³ÛŒØ± Ùˆ Ø§Ø³ØªÛŒÚ©': 'https://source.unsplash.com/800x600/?garlic-steak-pizza',
      'Ù¾ÛŒØªØ²Ø§ Ù¾Ù¾Ø±ÙˆÙ†ÛŒ': 'https://source.unsplash.com/800x600/?pepperoni-pizza',
      'Ù¾ÛŒØªØ²Ø§ Ù…Ø±Øº Ùˆ Ø¨ÙˆÙ‚Ù„Ù…ÙˆÙ†': 'https://source.unsplash.com/800x600/?chicken-pizza',
      'Ù¾ÛŒØªØ²Ø§ Ø±Ø³Øª Ø¨ÛŒÙ': 'https://source.unsplash.com/800x600/?roast-beef-pizza',
      'Ø¨Ø±Ú¯Ø± Ù…Ø®ØµÙˆØµ': 'https://source.unsplash.com/800x600/?gourmet-burger',
      'Ù‚Ø§Ø±Ú† Ø¨Ø±Ú¯Ø±': 'https://source.unsplash.com/800x600/?mushroom-burger',
      'Ø¨ÛŒÚ¯ Ø¨Ø±Ú¯Ø±': 'https://source.unsplash.com/800x600/?double-burger',
      'Ú†ÛŒÚ©Ù† Ø¨Ø±Ú¯Ø±': 'https://source.unsplash.com/800x600/?chicken-burger',
      'Ù‡Ø§Øª Ø¯Ø§Ú¯ Ø§Ù…Ø±ÛŒÚ©Ø§ÛŒÛŒ': 'https://source.unsplash.com/800x600/?hotdog',
      'Ù¾Ø§Ø³ØªØ§ Ø¢Ù„ÙØ±Ø¯Ùˆ': 'https://source.unsplash.com/800x600/?fettuccine-alfredo',
      'Ú†ÛŒÚ©Ù† Ø¢Ù„ÙØ±Ø¯Ùˆ': 'https://source.unsplash.com/800x600/?chicken-alfredo',
      'Ø¨ÛŒÙ Ø§Ø³ØªØ±Ø§Ú¯Ø§Ù†Ù': 'https://source.unsplash.com/800x600/?beef-stroganoff',
      'Ø³Ø§Ù„Ø§Ø¯ Ø³Ø²Ø§Ø±': 'https://source.unsplash.com/800x600/?caesar-salad',
      'Ø³Ø§Ù„Ø§Ø¯ ÛŒÙˆÙ†Ø§Ù†ÛŒ': 'https://source.unsplash.com/800x600/?greek-salad',
      'Ø³Ø§Ù„Ø§Ø¯ Ø³Ø¨Ø²ÛŒØ¬Ø§Øª': 'https://source.unsplash.com/800x600/?vegetable-salad',
      'Ø³Ù†Ø¯ØªÙ† ÙØ±Ø§ÛŒØ²': 'https://source.unsplash.com/800x600/?loaded-fries',
      'Ø³ÛŒØ¨â€ŒØ²Ù…ÛŒÙ†ÛŒ Ù¾Ù†ÛŒØ±ÛŒ': 'https://source.unsplash.com/800x600/?cheese-fries',
      'Ø³ÛŒØ¨â€ŒØ²Ù…ÛŒÙ†ÛŒ Ø³Ø§Ø¯Ù‡': 'https://source.unsplash.com/800x600/?french-fries',
      'Ø§Ø³Ù¾ÛŒØ´Ù„ Ú©Ø±Ø§Ø´ Ø§Ø³Ù†ÛŒÚ©Ø±Ø²': 'https://source.unsplash.com/800x600/?snickers-milkshake',
      'Ø§Ø³Ù¾ÛŒØ´Ù„ Ú©Ø±Ø§Ø´ Ú©ÛŒØªâ€ŒÚ©Øª': 'https://source.unsplash.com/800x600/?kitkat-milkshake',
      'Ø§Ø³Ù¾ÛŒØ´Ù„ Ú©Ø±Ø§Ø´ Ø§ÙˆØ±Ø¦Ùˆ': 'https://source.unsplash.com/800x600/?oreo-shake',
      'Ø´ÛŒÚ© Ø´Ú©Ù„Ø§Øª': 'https://source.unsplash.com/800x600/?chocolate-shake',
      'Ø´ÛŒÚ© Ù…Ø¹Ø¬ÙˆÙ†': 'https://source.unsplash.com/800x600/?milkshake',
      'Ø¢Ø¨ Ù¾Ø±ØªÙ‚Ø§Ù„': 'https://source.unsplash.com/800x600/?orange-juice',
      'Ø¢Ø¨ Ù‡Ù†Ø¯ÙˆØ§Ù†Ù‡': 'https://source.unsplash.com/800x600/?watermelon-juice',
      'Ø¢Ø¨ Ø·Ø§Ù„Ø¨ÛŒ': 'https://source.unsplash.com/800x600/?melon-juice',
      'Ù…Ø§Ø±Ú¯Ø§Ø±ÛŒØªØ§': 'https://source.unsplash.com/800x600/?margarita',
      'Ù„ÛŒÙ…ÙˆÙ†Ø§Ø¯ Ø·Ø¨ÛŒØ¹ÛŒ': 'https://source.unsplash.com/800x600/?lemonade',
      'Ù…ÙˆÙ‡ÛŒØªÙˆ': 'https://source.unsplash.com/800x600/?mojito',
      'Ú©ÙˆÚ©Ø§Ú©ÙˆÙ„Ø§': 'https://source.unsplash.com/800x600/?coca-cola',
      'Ù…ÛŒØ±Ø§Ù†Ø¯Ø§': 'https://source.unsplash.com/800x600/?mirinda',
      'ÙØ§Ù†ØªØ§': 'https://source.unsplash.com/800x600/?fanta',
      'Ú©ÛŒÚ©Ø³ Ù…Ú©Ø³': 'https://source.unsplash.com/800x600/?chips',
      'Ù…Ø§Ù„Ø´Ø¹ÛŒØ±': 'https://source.unsplash.com/800x600/?malt-drink',
      'Ù…Ø§Ù„Ø´Ø¹ÛŒØ± Ù„ÛŒÙ…Ùˆ': 'https://source.unsplash.com/800x600/?lemon-malt',
      'Ø¢Ø¨ Ù…Ø¹Ø¯Ù†ÛŒ Ú©ÙˆÚ†ÛŒÚ©': 'https://source.unsplash.com/800x600/?bottled-water',
      'Ù‡Ø§ÛŒÙ¾': 'https://source.unsplash.com/800x600/?energy-drink',
      'Ø§Ø³Ù¾Ø±Ø³Ùˆ ØªÚ©': 'https://source.unsplash.com/800x600/?espresso',
      'Ø§Ø³Ù¾Ø±Ø³Ùˆ Ø¯ÙˆØ¨Ù„': 'https://source.unsplash.com/800x600/?double-espresso',
      'Ø¢Ù…Ø±ÛŒÚ©Ø§Ù†Ùˆ': 'https://source.unsplash.com/800x600/?americano-coffee',
      'Ù…ÙˆÚ©Ø§ Ù„Ø§ØªÙ‡': 'https://source.unsplash.com/800x600/?mocha-latte',
      'Ú©Ø§ÙÙ‡ Ù„Ø§ØªÙ‡': 'https://source.unsplash.com/800x600/?caffe-latte',
      'Ú†Ø§ÛŒ Ø³Ø¨Ø²': 'https://source.unsplash.com/800x600/?green-tea',
      'Ú†Ø§ÛŒ': 'https://source.unsplash.com/800x600/?black-tea',
      'Ø¨Ù„ÙˆØ¨Ø±ÛŒ Ù†Ø¹Ù†Ø§ ': 'https://source.unsplash.com/800x600/?hookah',
      'Ø§Ù†Ø¨Ù‡': 'https://source.unsplash.com/800x600/?hookah',
      'Ù„ÛŒÙ…Ùˆ Ù†Ø¹Ù†Ø§': 'https://source.unsplash.com/800x600/?hookah',
      'Ù¾Ø±ØªÙ‚Ø§Ù„ Ø®Ø§Ù…Ù‡': 'https://source.unsplash.com/800x600/?hookah',
      'Ø¨Ù„ÙˆØ¨Ø±ÛŒ Ø²ÛŒØªÙˆÙ†': 'https://source.unsplash.com/800x600/?hookah',
      'Ù„Ø§Ùˆ': 'https://source.unsplash.com/800x600/?hookah',
      'Ù…Ø³Ú©Ùˆ': 'https://source.unsplash.com/800x600/?hookah',
      'Ù†Ø¹Ù†Ø§': 'https://source.unsplash.com/800x600/?hookah'
    };
    MENU_DATA.forEach(c=>c.items.forEach((it,i)=>{it.id = `${c.category}-${i}`; it.img = IMG_MAP[it.title] || 'logo.jpg'}));

    // ==== User Image Overrides (admin only) ====
    const IMG_USER = JSON.parse(localStorage.getItem('sandton_img')||'{}');
    const imgFor = (it)=> IMG_USER[it.title] || it.img;
    function setImg(title){
      const cur = IMG_USER[title] || '';
      const url = prompt(`Ù„ÛŒÙ†Ú© Ø¹Ú©Ø³ Ø¨Ø±Ø§ÛŒ Â«${title}Â» (Ø®Ø§Ù„ÛŒ = Ø­Ø°Ù)`, cur);
      if(url===null) return;
      if(url.trim()===''){ delete IMG_USER[title]; }
      else { IMG_USER[title]=url.trim(); }
      localStorage.setItem('sandton_img', JSON.stringify(IMG_USER));
      renderMenu();
    }
    const ADMIN = /[?&]admin=1/.test(location.search);(c=>c.items.forEach((it,i)=>{it.id = `${c.category}-${i}`; it.img = IMG_MAP[it.title] || 'logo.jpg'}));

    // ===== Elements =====
    const menu = document.getElementById('menu');
    const search = document.getElementById('search');
    const chipRow = document.getElementById('chipRow');
    const cartFab = document.getElementById('cartFab');
    const cartDrawer = document.getElementById('cartDrawer');
    const cartOverlay = document.getElementById('cartOverlay');
    const cartClose = document.getElementById('cartClose');
    const cartList = document.getElementById('cartList');
    const cartCount = document.getElementById('cartCount');
    const sumEl = document.getElementById('sum');
    const priceNote = document.getElementById('priceNote');
    const curMode = document.getElementById('curMode');
    const btnCopy = document.getElementById('btnCopy');
    const btnWA = document.getElementById('btnWA');
    const qrFab = document.getElementById('qrFab');
    const qrModal = document.getElementById('qrModal');
    const qrClose = document.getElementById('qrClose');

    // ===== State =====
    const state = { q:'', cat:'Ù‡Ù…Ù‡', cart: JSON.parse(localStorage.getItem('sandton_cart')||'{}') };

    // ===== Helpers =====
    const nf = new Intl.NumberFormat('fa-IR');
    const toTomans = thousands => +thousands * 1000; // Ú©Ù…Ú© Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ

    // ØªØ¨Ø¯ÛŒÙ„ ÙˆØ§Ø­Ø¯ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù‚ÛŒÙ…Øª Ø¢ÛŒØªÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ MODE
    function itemTomans(v){
      if(!v) return 0;
      if(PRICE_MODE==='mini') return +v;          // Ù‚ÛŒÙ…Øª Ø¯ÛŒØªØ§Ø³Øª Ø±Ø§ Â«ØªÙˆÙ…Ø§Ù†Â» Ø¯Ø± Ù†Ø¸Ø± Ø¨Ú¯ÛŒØ±
      if(PRICE_MODE==='toman') return toTomans(v);// ØªÙˆÙ…Ø§Ù† Ú©Ø§Ù…Ù„ = Ù‡Ø²Ø§Ø± * 1000
      // hezar
      return toTomans(v);                         // Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù† Ø¬Ø¯Ø§ Ù‡Ù†Ø¯Ù„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    }
    function moneyItem(v){
      if(!v) return 'â€”';
      if(PRICE_MODE==='hezar') return nf.format(+v) + ' Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†';
      return nf.format(itemTomans(v)) + ' ØªÙˆÙ…Ø§Ù†'; // mini Ùˆ toman
    }
    function sumDisplayUnits(){ // Ø¹Ø¯Ø¯ Ø®Ø§Ù… Ø¨Ù‡ ÙˆØ§Ø­Ø¯Ù Ù†Ù…Ø§ÛŒØ´
      return Object.entries(state.cart).reduce((acc,[id,qty])=>{
        const it = findById(id); if(!it || !it.price) return acc;
        if(PRICE_MODE==='hezar') return acc + (+it.price * qty);     // Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†
        if(PRICE_MODE==='mini')  return acc + (+it.price * qty);     // ØªÙˆÙ…Ø§Ù†Ù Ú©ÙˆÚ†Ú©
        return acc + (toTomans(it.price) * qty);                     // ØªÙˆÙ…Ø§Ù† Ú©Ø§Ù…Ù„
      },0);
    }
    function moneySum(){
      if(PRICE_MODE==='hezar') return nf.format(sumDisplayUnits()) + ' Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†';
      return nf.format(sumDisplayUnits()) + ' ØªÙˆÙ…Ø§Ù†'; // mini & toman
    }
    function sumThousands(){ // Ø¨Ø±Ø§ÛŒ payload Ø¨Ú©â€ŒØ§Ù†Ø¯
      if(PRICE_MODE==='hezar') return sumDisplayUnits();
      if(PRICE_MODE==='mini') return Math.round(sumDisplayUnits()/1000);
      return Math.round(sumDisplayUnits()/1000);
    }
    function sumTomans(){ // Ø¨Ø±Ø§ÛŒ payload Ø¨Ú©â€ŒØ§Ù†Ø¯
      if(PRICE_MODE==='hezar') return sumDisplayUnits()*1000;
      return sumDisplayUnits();
    }
    const findById = (id)=>{ for(const c of MENU_DATA){ const f = c.items.find(i=>i.id===id); if(f) return f; } };

    // ===== Chips =====
    function renderChips(){
      chipRow.innerHTML='';
      const all = ['Ù‡Ù…Ù‡', ...MENU_DATA.map(c=>c.category)];
      all.forEach(cat=>{
        const b = document.createElement('button'); b.className='chip'+(state.cat===cat?' active':''); b.textContent=cat; b.onclick=()=>{state.cat=cat; renderMenu(); scrollToSection(cat)}; chipRow.appendChild(b);
      });
    }
    function scrollToSection(cat){ if(cat==='Ù‡Ù…Ù‡') return; const esc=(window.CSS&&CSS.escape)?CSS.escape(cat):String(cat).replace(/["\\]/g,''); const el=document.querySelector(`[data-cat="${esc}"]`); if(el) el.scrollIntoView({behavior:'smooth',block:'start'}); }

    // ===== Menu =====
    function renderMenu(){
      const q=(state.q||'').trim().toLowerCase();
      menu.innerHTML='';
      MENU_DATA.forEach(block=>{
        if(state.cat!=='Ù‡Ù…Ù‡' && state.cat!==block.category) return;
        const sec=document.createElement('section'); sec.className='cat'; sec.dataset.cat=block.category;
        const h=document.createElement('h2'); h.className='cat-title'; h.innerHTML=`<span>ğŸ½ï¸</span>${block.category}`; sec.appendChild(h);
        const list=document.createElement('div'); list.className='grid';
        block.items.filter(it=> !q || it.title.toLowerCase().includes(q)).forEach(it=>{
          const card=document.createElement('article'); card.className='card';
          const pic=document.createElement('div'); pic.className='pic';
          const img=document.createElement('img');
          img.loading='lazy';
          img.src=imgFor(it);
          img.alt=it.title;
          img.onerror=()=>{ img.onerror=null; img.src = it.img || 'logo.jpg'; };
          pic.appendChild(img);
          if(ADMIN){ const eb=document.createElement('button'); eb.className='btn'; eb.style.position='absolute'; eb.style.left='8px'; eb.style.bottom='8px'; eb.textContent='ÙˆÛŒØ±Ø§ÛŒØ´ Ø¹Ú©Ø³'; eb.onclick=(e)=>{ e.stopPropagation(); setImg(it.title); }; card.appendChild(eb);}
          const info=document.createElement('div'); info.className='info';
          const t=document.createElement('h3'); t.className='title'; t.textContent=it.title;
          const p=document.createElement('div'); p.className='price'; p.textContent = it.price ? moneyItem(it.price) : 'â€”';
          const actions=document.createElement('div'); actions.className='actions';
          const add=document.createElement('button'); add.className='btn primary'; add.textContent='â• Ø§ÙØ²ÙˆØ¯Ù†'; add.onclick=()=>addToCart(it.id);
          const qty=document.createElement('div'); qty.className='qty';
          const minus=document.createElement('button'); minus.textContent='âˆ’';
          const qv=document.createElement('span'); qv.textContent=state.cart[it.id]||0;
          const plus=document.createElement('button'); plus.textContent='+';
          minus.onclick=()=>changeQty(it.id,-1,qv); plus.onclick=()=>changeQty(it.id,1,qv);
          qty.append(minus,qv,plus);
          actions.append(add,qty); info.append(t,p,actions); card.append(pic,info);
          if(!it.price){ const b=document.createElement('div'); b.className='badge'; b.textContent='Ù‚ÛŒÙ…Øª Ù…ØªØºÛŒØ±'; card.appendChild(b); }
          list.appendChild(card);
        });
        sec.appendChild(list); menu.appendChild(sec);
      });
      syncQtyBadges();
    }

    function syncQtyBadges(){
      document.querySelectorAll('.card').forEach(card=>{
        const title=card.querySelector('.title').textContent; let id=null; for(const c of MENU_DATA){ const it=c.items.find(i=>i.title===title); if(it){ id=it.id; break; }}
        if(!id) return; const span=card.querySelector('.qty span'); if(span) span.textContent=state.cart[id]||0;
      });
      updateCartUI();
    }

    // ===== Cart =====
    function addToCart(id){ state.cart[id]=(state.cart[id]||0)+1; persist(); updateCartUI(); bumpFab(); }
    function changeQty(id,delta,localSpan){ const cur=(state.cart[id]||0)+delta; state.cart[id]=Math.max(0,cur); if(state.cart[id]===0) delete state.cart[id]; persist(); if(localSpan) localSpan.textContent=state.cart[id]||0; updateCartUI(); }
    function removeFromCart(id){ delete state.cart[id]; persist(); updateCartUI(); }
    function clearCart(){ state.cart={}; persist(); updateCartUI(); }
    function persist(){ localStorage.setItem('sandton_cart', JSON.stringify(state.cart)); }
    function bumpFab(){ cartFab.style.transform='scale(1.06)'; setTimeout(()=>{cartFab.style.transform='scale(1)';},160); }

    function orderText(){
      const entries=Object.entries(state.cart);
      const lines=entries.map(([id,qty])=>{ const it=findById(id); return `â€¢ ${it.title} â€” ${nf.format(qty)} Ã— ${it.price?moneyItem(it.price):'â€”'}`; });
      const head='Ø³ÙØ§Ø±Ø´ Ø¬Ø¯ÛŒØ¯ Ø§Ø² ÙˆØ¨â€ŒØ³Ø§ÛŒØª Ø³Ù†Ø¯ØªÙ†';
      const sumLine='Ù…Ø¬Ù…ÙˆØ¹: '+moneySum();
      const name=document.getElementById('coName')?.value||''; const phone=document.getElementById('coPhone')?.value||'';
      const typeSel=document.getElementById('coType'); const typeTxt=typeSel?typeSel.options[typeSel.selectedIndex].text:'';
      const cust=['Ù†Ø§Ù…: '+name,'ØªÙ„ÙÙ†: '+phone,'Ù†ÙˆØ¹ ØªØ­ÙˆÛŒÙ„: '+typeTxt];
      const tableVal=(document.getElementById('coTable')?.value||'').trim(); if(tableVal) cust.push('Ù…ÛŒØ²: '+tableVal);
      const addrVal=(document.getElementById('coAddr')?.value||'').trim(); if(addrVal) cust.push('Ø¢Ø¯Ø±Ø³: '+addrVal);
      const noteVal=(document.getElementById('coNote')?.value||'').trim(); const note = noteVal? ('\nØªÙˆØ¶ÛŒØ­Ø§Øª: '+noteVal) : '';
      return [head,'',...lines,'â€”',sumLine,'',...cust].join('\n')+note;
    }

    function updateCartUI(){
      const totalQty=Object.values(state.cart).reduce((a,b)=>a+b,0); cartCount.textContent=totalQty;
      cartList.innerHTML=''; const entries=Object.entries(state.cart);
      if(entries.length===0){ cartList.innerHTML='<div class="muted">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</div>'; }
      else{ entries.forEach(([id,qty])=>{ const it=findById(id); if(!it) return; const row=document.createElement('div'); row.className='cart-item'; row.innerHTML=`
            <img src="${it.img}" alt="${it.title}">
            <div>
              <div class="cart-title">${it.title}</div>
              <div class="cart-meta">${it.price?moneyItem(it.price):'â€”'} Ã— ${nf.format(qty)}</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
              <div class="cart-qty">
                <button data-act="minus">âˆ’</button>
                <span>${nf.format(qty)}</span>
                <button data-act="plus">+</button>
              </div>
              <button class="remove" data-act="remove">Ø­Ø°Ù</button>
            </div>`; row.querySelector('[data-act="minus"]').onclick=()=>changeQty(id,-1); row.querySelector('[data-act="plus"]').onclick=()=>changeQty(id,1); row.querySelector('[data-act="remove"]').onclick=()=>removeFromCart(id); cartList.appendChild(row); }); }
      sumEl.textContent = moneySum();
      btnWA.href = `https://wa.me/989378938200?text=${encodeURIComponent(orderText())}`;
      btnCopy.onclick = async ()=>{ try{ await navigator.clipboard.writeText(orderText()); btnCopy.textContent='Ú©Ù¾ÛŒ Ø´Ø¯ âœ…'; setTimeout(()=>btnCopy.textContent='Ú©Ù¾ÛŒ Ø³ÙØ§Ø±Ø´',1200);}catch{ alert('Ú©Ù¾ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯'); } };
      curMode.textContent = (
        PRICE_MODE==='toman' ? 'ØªÙˆÙ…Ø§Ù† Ú©Ø§Ù…Ù„' : PRICE_MODE==='hezar' ? 'Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù† (Ø¨Ø¯ÙˆÙ† Ø³Ù‡ ØµÙØ±)' : 'ØªÙˆÙ…Ø§Ù† (Ø¨Ø¯ÙˆÙ† Ø³Ù‡ ØµÙØ±)'
      );
      priceNote.textContent = (
        PRICE_MODE==='toman' ? 'ØªÙ…Ø§Ù… Ù…Ø¨Ø§Ù„Øº Ø¨Ù‡ ØªÙˆÙ…Ø§Ù† Ú©Ø§Ù…Ù„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.' : PRICE_MODE==='hezar' ? 'ØªÙ…Ø§Ù… Ù…Ø¨Ø§Ù„Øº Ø¨Ù‡ Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.' : 'ØªÙ…Ø§Ù… Ù…Ø¨Ø§Ù„Øº Ø¨Ù‡ ØªÙˆÙ…Ø§Ù† (Ø¨Ø¯ÙˆÙ† Ø³Ù‡ ØµÙØ±) Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.'
      );
    }

    // ===== Drawer & Checkout =====
    function openDrawer(){ cartDrawer.classList.add('active'); cartDrawer.setAttribute('aria-hidden','false'); }
    function closeDrawer(){ cartDrawer.classList.remove('active'); cartDrawer.setAttribute('aria-hidden','true'); }
    cartFab.onclick=openDrawer; cartOverlay.onclick=closeDrawer; cartClose.onclick=closeDrawer;

    const coModal=document.getElementById('coModal'); const coClose=document.getElementById('coClose'); const coForm=document.getElementById('coForm');
    function openCO(){ coModal.style.display='flex'; } function closeCO(){ coModal.style.display='none'; }
    document.getElementById('btnCheckout').onclick=openCO; coClose.onclick=closeCO; coModal.addEventListener('click',e=>{ if(e.target===coModal) closeCO(); });
    const coType=document.getElementById('coType'); const coTableWrap=document.getElementById('coTableWrap'); const coAddrWrap=document.getElementById('coAddrWrap');
    coType.addEventListener('change', ()=>{ const v=coType.value; coTableWrap.style.display= v==='dinein'?'grid':'none'; coAddrWrap.style.display= v==='delivery'?'grid':'none'; });

    document.getElementById('coSendWA').onclick=()=>{ if(!coForm.reportValidity()) return; window.open(`https://wa.me/989378938200?text=${encodeURIComponent(orderText())}`,'_blank'); };

    // Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ù†Ù„Ø§ÛŒÙ† (Ø¯Ù…Ùˆ): Ø³Ø§Ø®Øª payload Ùˆ Ù†Ù…Ø§ÛŒØ´
    document.getElementById('btnPay').onclick=()=>{
      if(!coForm.reportValidity()) return;
      const items = Object.entries(state.cart).map(([id,qty])=>{ const it=findById(id); const p = +(it.price||0); return { id, title: it.title, qty, unit_thousand: (PRICE_MODE==='mini'? Math.round(p/1000) : p), unit_toman: (PRICE_MODE==='mini'? p : toTomans(p)) }; });
      const payload = {
        customer: { name: document.getElementById('coName').value, phone: document.getElementById('coPhone').value },
        deliver: { type: coType.value, table: document.getElementById('coTable').value, address: document.getElementById('coAddr').value },
        amounts: { thousands: sumThousands(), tomans: sumTomans(), display: moneySum(), mode: PRICE_MODE },
        items
      };
      console.log('PAYMENT_PAYLOAD', payload);
      alert('Ø¯Ù…Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÙØ§Ø±Ø´ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø± Ú†Ø§Ù¾ Ø´Ø¯. Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø¯Ø±Ú¯Ø§Ù‡ØŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ Ø¨Ù‡ Ù…Ù† Ø¨Ø¯Ù‡.');
    };

    coForm.addEventListener('submit', e=>{ e.preventDefault(); if(!coForm.reportValidity()) return; navigator.clipboard.writeText(orderText()).then(()=>{ alert('Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ùˆ Ù…ØªÙ† Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ú©Ù¾ÛŒ Ø´Ø¯.'); clearCart(); closeCO(); closeDrawer(); }).catch(()=>{ alert('Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ù…ØªÙ† Ø±Ø§ Ø¯Ø³ØªÛŒ Ú©Ù¾ÛŒ/Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.'); clearCart(); closeCO(); closeDrawer(); }); });

    search.addEventListener('input', e=>{ state.q=e.target.value; renderMenu(); });

    function openQR(){ qrModal.style.display='flex'; const box=document.getElementById('qrcode'); box.innerHTML=''; new QRCode(box,{text:window.location.href,width:256,height:256}); } function closeQR(){ qrModal.style.display='none'; }
    qrFab.onclick=openQR; qrClose.onclick=closeQR; qrModal.addEventListener('click',e=>{ if(e.target===qrModal) closeQR(); });

    renderChips(); renderMenu(); updateCartUI();

    // ===== Tests =====
    (function tests(){
      try{
        // Ù‚ÛŒÙ…Øª: Ø­Ø§Ù„Øª ØªÙˆÙ…Ø§Ù† Ú©Ø§Ù…Ù„
        const bak = PRICE_MODE;
        const _nf = new Intl.NumberFormat('fa-IR');
        console.assert(toTomans(2)===2000,'toTomans failed');
        // Ø¬Ù…Ø¹ Ø®Ø§Ù„ÛŒ
        const prev=JSON.parse(JSON.stringify(state.cart)); state.cart={}; localStorage.setItem('sandton_cart','{}'); console.assert(sumThousands()===0 && sumTomans()===0,'sum empty failed');
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÛŒÚ© Ù‚Ù„Ù…
        const first=MENU_DATA[0].items[0]; state.cart[first.id]=2; console.assert(sumThousands()=== (+first.price*2), 'sumThousands mismatch');
        state.cart=prev; localStorage.setItem('sandton_cart', JSON.stringify(prev));
        console.log('%cAll tests passed','color:#2BD4BD');
      }catch(e){ console.warn('Tests error',e); }
    })();
  </script>
</body>
</html>
